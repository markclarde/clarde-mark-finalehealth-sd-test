<div class="patient-list-container">
  <div class="header">
    <h2>Patient List</h2>
  </div>

  <div class="search-section">
    <mat-form-field appearance="outline" class="search-input">
      <mat-label>Search by name or email</mat-label>
      <input matInput [(ngModel)]="searchQuery" (input)="onSearchChange()" />
    </mat-form-field>

    <button mat-raised-button class="create-btn" (click)="onCreate()">
      + Create Patient
    </button>
  </div>

  <app-patient-form-modal
    *ngIf="showModal"
    [patient]="selectedPatient"
    (close)="onModalClose($event)"
    (delete)="onModalDelete($event)"
  ></app-patient-form-modal>

  <div class="table-section">
    <table mat-table [dataSource]="patients" class="patient-table" *ngIf="!loading && patients.length > 0">

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let patient">{{ patient.firstName }} {{ patient.lastName }}</td>
      </ng-container>

      <ng-container matColumnDef="dob">
        <th mat-header-cell *matHeaderCellDef>DOB</th>
        <td mat-cell *matCellDef="let patient">{{ patient.dob | date }}</td>
      </ng-container>

      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>Email</th>
        <td mat-cell *matCellDef="let patient">{{ patient.email }}</td>
      </ng-container>

      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef>Phone</th>
        <td mat-cell *matCellDef="let patient">{{ patient.phoneNumber }}</td>
      </ng-container>

      <ng-container matColumnDef="address">
        <th mat-header-cell *matHeaderCellDef>Address</th>
        <td mat-cell *matCellDef="let patient">{{ patient.address }}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let patient">
          <div class="actions">
            <button mat-button class="view-btn" (click)="onView(patient.id)">View</button>
            <button mat-button class="edit-btn" (click)="onEdit(patient)">Edit</button>
            <button mat-button class="delete-btn" (click)="onDelete(patient.id)">Delete</button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <p *ngIf="!loading && patients.length === 0">No patients found.</p>
    <p *ngIf="loading">Loading...</p>
  </div>

  <div class="pagination">
    <button mat-raised-button (click)="changePage(page - 1)" [disabled]="page <= 1">
      Previous
    </button>
    <span>Page {{ page }} of {{ totalPages }}</span>
    <button mat-raised-button (click)="changePage(page + 1)" [disabled]="page >= totalPages">
      Next
    </button>
  </div>
</div>
