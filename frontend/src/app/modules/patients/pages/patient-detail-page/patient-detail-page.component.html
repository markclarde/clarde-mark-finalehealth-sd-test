<div class="patient-list-container">
  <div class="header">
    <button class="back-button" (click)="goBack()">‚Üê Back</button>
    <h2>Patient Details</h2>
  </div>

  <div *ngIf="loading" class="loading">Loading patient details...</div>

  <div *ngIf="!loading && patient" class="patient-details">
    <p><strong>Name:</strong> {{ patient.firstName }} {{ patient.lastName }}</p>
    <p><strong>Date of Birth:</strong> {{ patient.dob | date }}</p>
    <p><strong>Email:</strong> {{ patient.email }}</p>
    <p><strong>Phone Number:</strong> {{ patient.phoneNumber }}</p>
    <p><strong>Address:</strong> {{ patient.address }}</p>

    <div class="visits-section">
      <div class="visits-header">
        <h3>Visit History</h3>
        <button class="create-visit-button" (click)="openVisitModal()">+ Create Visit</button>
      </div>

      <visit-form-modal
        *ngIf="showModal && patient"
        [patientId]="patient.id"
        [visitToEdit]="editingVisit"
        (submitted)="handleVisitSubmitted($event)"
        (cancelled)="closeVisitModal()"
      ></visit-form-modal>

      <div *ngIf="visits.length === 0">No visits found for this patient.</div>

      <table *ngIf="visits.length > 0" class="visits-table">
        <thead>
          <tr>
            <th>Visit Type</th>
            <th>Visit Date</th>
            <th>Notes</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let visit of visits">
            <td>{{ visit.visitType }}</td>
            <td>{{ visit.visitDate | date: 'mediumDate' }}</td>
            <td>{{ visit.notes || 'No notes' }}</td>
            <td>
              <button (click)="openVisitModal(visit)">Edit</button>
              <button (click)="deleteVisit(visit._id)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div *ngIf="!loading && !patient" class="not-found">
    Patient not found.
  </div>
</div>
